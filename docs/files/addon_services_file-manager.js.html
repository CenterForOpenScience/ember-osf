<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/services/file-manager.js - Ember OSF Addon</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="https://cdn.cos.io/static/images/cos_wide.png" title="Ember OSF Addon"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.19.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ajax-helpers.html">ajax-helpers</a></li>
                                <li><a href="../classes/Analytics.html">Analytics</a></li>
                                <li><a href="../classes/auth.html">auth</a></li>
                                <li><a href="../classes/author-link.html">author-link</a></li>
                                <li><a href="../classes/buildSecondaryNavLinks.html">buildSecondaryNavLinks</a></li>
                                <li><a href="../classes/CasAuthenticatedRouteMixin.html">CasAuthenticatedRouteMixin</a></li>
                                <li><a href="../classes/Citation.html">Citation</a></li>
                                <li><a href="../classes/citation-widget.html">citation-widget</a></li>
                                <li><a href="../classes/Collection.html">Collection</a></li>
                                <li><a href="../classes/Comment.html">Comment</a></li>
                                <li><a href="../classes/comment-detail.html">comment-detail</a></li>
                                <li><a href="../classes/comment-form.html">comment-form</a></li>
                                <li><a href="../classes/comment-pane.html">comment-pane</a></li>
                                <li><a href="../classes/CommentableMixin.html">CommentableMixin</a></li>
                                <li><a href="../classes/CommentReport.html">CommentReport</a></li>
                                <li><a href="../classes/Contributor.html">Contributor</a></li>
                                <li><a href="../classes/current-user.html">current-user</a></li>
                                <li><a href="../classes/discover-page.html">discover-page</a></li>
                                <li><a href="../classes/DraftRegistration.html">DraftRegistration</a></li>
                                <li><a href="../classes/dropzone-widget.html">dropzone-widget</a></li>
                                <li><a href="../classes/elem-id.html">elem-id</a></li>
                                <li><a href="../classes/eosf-project-nav.html">eosf-project-nav</a></li>
                                <li><a href="../classes/faceted-search.html">faceted-search</a></li>
                                <li><a href="../classes/File.html">File</a></li>
                                <li><a href="../classes/file-browser.html">file-browser</a></li>
                                <li><a href="../classes/file-browser-icon.html">file-browser-icon</a></li>
                                <li><a href="../classes/file-chooser component.html">file-chooser component</a></li>
                                <li><a href="../classes/file-editor.html">file-editor</a></li>
                                <li><a href="../classes/file-manager.html">file-manager</a></li>
                                <li><a href="../classes/file-renderer.html">file-renderer</a></li>
                                <li><a href="../classes/file-version.html">file-version</a></li>
                                <li><a href="../classes/file-widget.html">file-widget</a></li>
                                <li><a href="../classes/FileCacheBypassMixin.html">FileCacheBypassMixin</a></li>
                                <li><a href="../classes/FileItemMixin.html">FileItemMixin</a></li>
                                <li><a href="../classes/FileProvider.html">FileProvider</a></li>
                                <li><a href="../classes/FileVersion.html">FileVersion</a></li>
                                <li><a href="../classes/filterReplace.html">filterReplace</a></li>
                                <li><a href="../classes/fix-special-char.html">fix-special-char</a></li>
                                <li><a href="../classes/fix-special-char-helper.html">fix-special-char-helper</a></li>
                                <li><a href="../classes/fixstring.html">fixstring</a></li>
                                <li><a href="../classes/GenericDataADapter.html">GenericDataADapter</a></li>
                                <li><a href="../classes/getDisplayName.html">getDisplayName</a></li>
                                <li><a href="../classes/HostAppNameMixin.html">HostAppNameMixin</a></li>
                                <li><a href="../classes/human-file-size.html">human-file-size</a></li>
                                <li><a href="../classes/ifFilter.html">ifFilter</a></li>
                                <li><a href="../classes/InfinityCustomMixin.html">InfinityCustomMixin</a></li>
                                <li><a href="../classes/Institution.html">Institution</a></li>
                                <li><a href="../classes/license-picker.html">license-picker</a></li>
                                <li><a href="../classes/Log.html">Log</a></li>
                                <li><a href="../classes/Metaschema.html">Metaschema</a></li>
                                <li><a href="../classes/mimeTypes.html">mimeTypes</a></li>
                                <li><a href="../classes/navbar-auth-dropdown.html">navbar-auth-dropdown</a></li>
                                <li><a href="../classes/new-navbar-auth-dropdown.html">new-navbar-auth-dropdown</a></li>
                                <li><a href="../classes/Node.html">Node</a></li>
                                <li><a href="../classes/NodeActionsMixin.html">NodeActionsMixin</a></li>
                                <li><a href="../classes/NodeLink.html">NodeLink</a></li>
                                <li><a href="../classes/oauth-popup.html">oauth-popup</a></li>
                                <li><a href="../classes/old-file-browser.html">old-file-browser</a></li>
                                <li><a href="../classes/osf-copyright.html">osf-copyright</a></li>
                                <li><a href="../classes/osf-footer.html">osf-footer</a></li>
                                <li><a href="../classes/osf-mode-footer.html">osf-mode-footer</a></li>
                                <li><a href="../classes/osf-navbar.html">osf-navbar</a></li>
                                <li><a href="../classes/osf-paginator.html">osf-paginator</a></li>
                                <li><a href="../classes/osf-services.html">osf-services</a></li>
                                <li><a href="../classes/OsfAdapter.html">OsfAdapter</a></li>
                                <li><a href="../classes/OsfAgnosticAuthController.html">OsfAgnosticAuthController</a></li>
                                <li><a href="../classes/OsfAgnosticAuthRoute.html">OsfAgnosticAuthRoute</a></li>
                                <li><a href="../classes/OsfCookieAuthenticator.html">OsfCookieAuthenticator</a></li>
                                <li><a href="../classes/OsfCookieAuthorizer.html">OsfCookieAuthorizer</a></li>
                                <li><a href="../classes/OsfCookieLoginController.html">OsfCookieLoginController</a></li>
                                <li><a href="../classes/OsfCookieLoginRoute.html">OsfCookieLoginRoute</a></li>
                                <li><a href="../classes/OsfModel.html">OsfModel</a></li>
                                <li><a href="../classes/OsfSerializer.html">OsfSerializer</a></li>
                                <li><a href="../classes/OsfTokenAuthenticator.html">OsfTokenAuthenticator</a></li>
                                <li><a href="../classes/OsfTokenAuthorizer.html">OsfTokenAuthorizer</a></li>
                                <li><a href="../classes/OsfTokenLoginControllerMixin.html">OsfTokenLoginControllerMixin</a></li>
                                <li><a href="../classes/OsfTokenLoginRouteMixin.html">OsfTokenLoginRouteMixin</a></li>
                                <li><a href="../classes/outside-click.html">outside-click</a></li>
                                <li><a href="../classes/PaginatedControllerMixin.html">PaginatedControllerMixin</a></li>
                                <li><a href="../classes/PaginatedRouteMixin.html">PaginatedRouteMixin</a></li>
                                <li><a href="../classes/pagination-control.html">pagination-control</a></li>
                                <li><a href="../classes/permissions.html">permissions</a></li>
                                <li><a href="../classes/Preprint.html">Preprint</a></li>
                                <li><a href="../classes/project-selector.html">project-selector</a></li>
                                <li><a href="../classes/providerRegex.html">providerRegex</a></li>
                                <li><a href="../classes/Registration.html">Registration</a></li>
                                <li><a href="../classes/RegistrationActionsMixin.html">RegistrationActionsMixin</a></li>
                                <li><a href="../classes/scheduled-banner.html">scheduled-banner</a></li>
                                <li><a href="../classes/search-dropdown.html">search-dropdown</a></li>
                                <li><a href="../classes/search-facet-locked.html">search-facet-locked</a></li>
                                <li><a href="../classes/search-help-modal.html">search-help-modal</a></li>
                                <li><a href="../classes/search-result.html">search-result</a></li>
                                <li><a href="../classes/service-links.html">service-links</a></li>
                                <li><a href="../classes/sign-up.html">sign-up</a></li>
                                <li><a href="../classes/sortOptionDisplay.html">sortOptionDisplay</a></li>
                                <li><a href="../classes/Subscription.html">Subscription</a></li>
                                <li><a href="../classes/TaggableMixin.html">TaggableMixin</a></li>
                                <li><a href="../classes/tags-widget.html">tags-widget</a></li>
                                <li><a href="../classes/Taxonomy.html">Taxonomy</a></li>
                                <li><a href="../classes/theme.html">theme</a></li>
                                <li><a href="../classes/total-share-results.html">total-share-results</a></li>
                                <li><a href="../classes/User.html">User</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/adapters.html">adapters</a></li>
                                <li><a href="../modules/authenticators.html">authenticators</a></li>
                                <li><a href="../modules/authorizers.html">authorizers</a></li>
                                <li><a href="../modules/components.html">components</a></li>
                                <li><a href="../modules/const.html">const</a></li>
                                <li><a href="../modules/ember-osf.html">ember-osf</a></li>
                                <li><a href="../modules/helpers.html">helpers</a></li>
                                <li><a href="../modules/mixins.html">mixins</a></li>
                                <li><a href="../modules/models.html">models</a></li>
                                <li><a href="../modules/serializers.html">serializers</a></li>
                                <li><a href="../modules/services.html">services</a></li>
                                <li><a href="../modules/transforms.html">transforms</a></li>
                                <li><a href="../modules/utils.html">utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: addon/services/file-manager.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Ember from &#x27;ember&#x27;;
import config from &#x27;ember-get-config&#x27;;

import { authenticatedAJAX } from &#x27;ember-osf/utils/ajax-helpers&#x27;;

/**
 * @module ember-osf
 * @submodule services
 */

/**
 * An Ember service for doing things to files.
 * Essentially a wrapper for the Waterbutler API.
 * http://waterbutler.readthedocs.io/
 *
 * @class file-manager
 * @extends Ember.Service
 */
export default Ember.Service.extend({
    session: Ember.inject.service(),
    store: Ember.inject.service(),

    /**
     * Get a URL to download the given file.
     *
     * @method getDownloadUrl
     * @param {file} file A &#x60;file&#x60; model
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the URL.
     * @param {Object} [options.query.version] &#x60;file-version&#x60; ID
     * @return {String} Download URL
     */
    getDownloadUrl(file, options = {}) {
        let url = file.get(&#x27;links.download&#x27;);

        if (!options.query) {
            options.query = {};
        }
        if (file.get(&#x27;isFolder&#x27;)) {
            options.query.zip = &#x27;&#x27;;
        }
        let queryString = Ember.$.param(options.query);
        if (queryString.length) {
            return &#x60;${url}?${queryString}&#x60;;
        } else {
            return url;
        }
    },

    /**
     * Download the contents of the given file.
     *
     * @method getContents
     * @param {file} file A &#x60;file&#x60; model with &#x60;isFolder == false&#x60;.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @return {Promise} Promise that resolves to the file contents or rejects
     * with an error message.
     */
    getContents(file, options = {}) {
        let url = file.get(&#x27;links.download&#x27;);
        return this._waterbutlerRequest(&#x27;GET&#x27;, url, options);
    },

    /**
     * Upload a new version of an existing file.
     *
     * @method updateContents
     * @param {file} file A &#x60;file&#x60; model with &#x60;isFolder == false&#x60;.
     * @param {Object} contents A native &#x60;File&#x60; object or another appropriate
     * payload for uploading.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @return {Promise} Promise that resolves to the updated &#x60;file&#x60; model or
     * rejects with an error message.
     */
    updateContents(file, contents, options = {}) {
        let url = file.get(&#x27;links&#x27;).upload;
        if (!options.query) {
            options.query = {};
        }
        options.query.kind = &#x27;file&#x27;;
        options.data = contents;

        let p = this._waterbutlerRequest(&#x27;PUT&#x27;, url, options);
        return p.then(() =&gt; this._reloadModel(file));
    },

    /**
     * Check out a file, so only the current user can modify it.
     *
     * @method checkOut
     * @param {file} file &#x60;file&#x60; model with &#x60;isFolder == false&#x60;.
     * @return {Promise} Promise that resolves on success or rejects with an
     * error message.
     */
    checkOut(file) {
        return Ember.run(() =&gt; {
            let userID = this.get(&#x27;session.data.authenticated.id&#x27;);
            file.set(&#x27;checkout&#x27;, userID);
            return file.save().catch((error) =&gt; {
                file.rollbackAttributes();
                throw error;
            });
        });
    },

    /**
     * Check in a file, so anyone with permission can modify it.
     *
     * @method checkOut
     * @param {file} file &#x60;file&#x60; model with &#x60;isFolder == false&#x60;.
     * @return {Promise} Promise that resolves on success or rejects with an
     * error message.
     */
    checkIn(file) {
        return Ember.run(() =&gt; {
            file.set(&#x27;checkout&#x27;, null);
            return file.save().catch((error) =&gt; {
                file.rollbackAttributes();
                throw error;
            });
        });
    },

    /**
     * Create a new folder
     *
     * @method addSubfolder
     * @param {file} folder Location of the new folder, a &#x60;file&#x60; model with
     * &#x60;isFolder == true&#x60;.
     * @param {String} name Name of the folder to create.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @return {Promise} Promise that resolves to the new folder&#x27;s model or
     * rejects with an error message.
     */
    addSubfolder(folder, name, options = {}) {
        let url = folder.get(&#x27;links&#x27;).new_folder;
        if (!options.query) {
            options.query = {};
        }
        options.query.name = name;
        options.query.kind = &#x27;folder&#x27;;

        // HACK: This is the only WB link that already has a query string
        let queryStart = url.search(/\?kind=folder$/);
        if (queryStart &gt; -1) {
            url = url.slice(0, queryStart);
        }
        let p = this._waterbutlerRequest(&#x27;PUT&#x27;, url, options);
        return p.then(() =&gt; this._getNewFileInfo(folder, name));
    },

    /**
     * Upload a file
     *
     * @method uploadFile
     * @param {file} folder Location of the new file, a &#x60;file&#x60; model with
     * &#x60;isFolder == true&#x60;.
     * @param {String} name Name of the new file.
     * @param {Object} contents A native &#x60;File&#x60; object or another appropriate
     * payload for uploading.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @return {Promise} Promise that resolves to the new file&#x27;s model or
     * rejects with an error message.
     */
    uploadFile(folder, name, contents, options = {}) {
        let url = folder.get(&#x27;links&#x27;).upload;
        options.data = contents;
        if (!options.query) {
            options.query = {};
        }
        options.query.name = name;
        options.query.kind = &#x27;file&#x27;;

        let p = this._waterbutlerRequest(&#x27;PUT&#x27;, url, options);
        return p.then(() =&gt; this._getNewFileInfo(folder, name));
    },

    /**
     * Rename a file or folder
     *
     * @method rename
     * @param {file} file &#x60;file&#x60; model to rename.
     * @param {String} newName New name for the file.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @return {Promise} Promise that resolves to the updated &#x60;file&#x60; model or
     * rejects with an error message.
     */
    rename(file, newName, options = {}) {
        let url = file.get(&#x27;links&#x27;).move;
        options.data = JSON.stringify({ action: &#x27;rename&#x27;, rename: newName });

        let p = this._waterbutlerRequest(&#x27;POST&#x27;, url, options);
        return p.then(() =&gt; this._reloadModel(file));
    },

    /**
     * Move (or copy) a file or folder
     *
     * @method move
     * @param {file} file &#x60;file&#x60; model to move.
     * @param {file} targetFolder Where to move the file, a &#x60;file&#x60; model with
     * &#x60;isFolder == true&#x60;.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @param {String} [options.data.rename] If specified, also rename the file
     * to the given name.
     * @param {String} [options.data.resource] Optional node ID. If specified,
     * move the file to that node.
     * @param {String} [options.data.provider] Optional provider name. If
     * specified, move the file to that provider.
     * @param {String} [options.data.action=&#x27;move&#x27;] Either &#x27;move&#x27; or &#x27;copy&#x27;.
     * @param {String} [options.data.conflict=&#x27;replace&#x27;] Specifies what to do if
     * a file of the same name already exists in the target folder. If &#x27;keep&#x27;,
     * rename this file to avoid conflict. If replace, the existing file is
     * destroyed.
     * @return {Promise} Promise that resolves to the the updated (or newly
     * created) &#x60;file&#x60; model or rejects with an error message.
     */
    move(file, targetFolder, options = {}) {
        let url = file.get(&#x27;links&#x27;).move;
        let defaultData = {
            action: &#x27;move&#x27;,
            path: targetFolder.get(&#x27;path&#x27;)
        };
        Ember.$.extend(defaultData, options.data);
        options.data = JSON.stringify(defaultData);

        let p = this._waterbutlerRequest(&#x27;POST&#x27;, url, options);
        return p.then((wbResponse) =&gt; {
            let name = wbResponse.data.attributes.name;
            return this._getNewFileInfo(targetFolder, name);
        });
    },

    /**
     * Copy a file or folder.
     * Convenience method for &#x60;move&#x60; with &#x60;options.copy == true&#x60;.
     *
     * @method copy
     * @param {file} file &#x60;file&#x60; model to copy.
     * @param {file} targetFolder Where to copy the file, a &#x60;file&#x60; model with
     * &#x60;isFolder == true&#x60;.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @param {String} [options.data.rename] If specified, also rename the file
     * to the given name.
     * @param {String} [options.data.resource] Optional node ID. If specified,
     * move the file to that node.
     * @param {String} [options.data.provider] Optional provider name. If
     * specified, move the file to that provider.
     * @param {String} [options.data.conflict=&#x27;replace&#x27;] Specifies what to do if
     * a file of the same name already exists in the target folder. If &#x27;keep&#x27;,
     * rename this file to avoid conflict. If replace, the existing file is
     * destroyed.
     * @return {Promise} Promise that resolves to the the new &#x60;file&#x60; model or
     * rejects with an error message.
     */
    copy(file, targetFolder, options={}) {
        if (!options.data) {
            options.data = {};
        }
        options.data.action = &#x27;copy&#x27;;
        return this.move(file, targetFolder, options);
    },

    /**
     * Delete a file or folder
     *
     * @method deleteFile
     * @param {file} file &#x60;file&#x60; model to delete.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @return {Promise} Promise that resolves on success or rejects with an
     * error message.
     */
    deleteFile(file, options = {}) {
        let url = file.get(&#x27;links&#x27;).delete;
        let p = this._waterbutlerRequest(&#x27;DELETE&#x27;, url, options);
        return p.then(() =&gt; file.get(&#x27;parentFolder&#x27;).then((parent) =&gt; {
                if (parent) {
                    return this._reloadModel(parent.get(&#x27;files&#x27;));
                } else {
                    this.get(&#x27;store&#x27;).unloadRecord(file);
                    return true;
                }
            })
        );
    },

    /**
     * Check whether the given url corresponds to a model that is currently
     * reloading after a file operation.
     *
     * Used by &#x60;mixin:file-cache-bypass&#x60; to avoid a race condition where the
     * cache might return stale, inaccurate data.
     *
     * @method isReloadingUrl
     * @param {String} url
     * @return {Boolean} &#x60;true&#x60; if &#x60;url&#x60; corresponds to a pending reload on a
     * model immediately after a Waterbutler action, otherwise &#x60;false&#x60;.
     */
    isReloadingUrl(url) {
        return !!this._reloadingUrls[url];
    },

    /**
     * Hash set of URLs for &#x60;model.reload()&#x60; calls that are still pending.
     *
     * @property _reloadingUrls
     * @private
     */
    _reloadingUrls: {},

    /**
     * Force-reload a model from the API.
     *
     * @method _reloadModel
     * @private
     * @param {Object} model &#x60;file&#x60; model or a &#x60;files&#x60; relationship
     * @return {Promise} Promise that resolves to the reloaded model or
     * rejects with an error message.
     */
    _reloadModel(model) {
        // If it&#x27;s a file model, it has its own URL in &#x60;links.info&#x60;.
        let reloadUrl = model.get(&#x27;links.info&#x27;);
        if (!reloadUrl) {
            // If it&#x27;s not a file model, it must be a relationship.
            // HACK: Looking at Ember&#x27;s privates.
            reloadUrl = model.get(&#x27;content.relationship.link&#x27;);
        }
        if (reloadUrl) {
            this._reloadingUrls[reloadUrl] = true;
        }

        return model.reload().then((freshModel) =&gt; {
            if (reloadUrl) {
                delete this._reloadingUrls[reloadUrl];
            }
            return freshModel;
        }).catch((error) =&gt; {
            if (reloadUrl) {
                delete this._reloadingUrls[reloadUrl];
            }
            throw error;
        });
    },

    /**
     * Make a Waterbutler request
     *
     * @method _waterbutlerRequest
     * @private
     * @param {String} method HTTP method for the request.
     * @param {String} url Waterbutler URL.
     * @param {Object} [options] Options hash
     * @param {Object} [options.query] Key-value hash of query parameters to
     * add to the request URL.
     * @param {Object} [options.data] Payload to be sent.
     * @return {Promise} Promise that resolves to the data returned from the
     * server on success, or rejects with an error message.
     */
    _waterbutlerRequest(method, url, options = {}) {
        if (options.query) {
            let queryString = Ember.$.param(options.query);
            url = &#x60;${url}?${queryString}&#x60;;
        }

        let headers = {};
        let authType = config[&#x27;ember-simple-auth&#x27;].authorizer;
        this.get(&#x27;session&#x27;).authorize(authType, (headerName, content) =&gt; {
            headers[headerName] = content;
        });

        return new Ember.RSVP.Promise((resolve, reject) =&gt; {
            let p = authenticatedAJAX({
                url,
                method,
                headers,
                data: options.data,
                processData: false
            });
            p.done((data) =&gt; resolve(data));
            p.fail((_, __, error) =&gt; reject(error));
        });
    },

    /**
     * Get the &#x60;file&#x60; model for a newly created file.
     *
     * @method _getNewFileInfo
     * @private
     * @param {file} parentFolder Model for the new file&#x27;s parent folder.
     * @param {String} name Name of the new file.
     * @return {Promise} Promise that resolves to the new file&#x27;s model or
     * rejects with an error message.
     */
    _getNewFileInfo(parentFolder, name) {
        let p = parentFolder.queryHasMany(&#x27;files&#x27;, {
            &#x27;filter[name]&#x27;: name
        });
        return p.then((files) =&gt; {
            let file = files.findBy(&#x27;name&#x27;, name);
            if (!file) {
                throw &#x27;Cannot load metadata for uploaded file.&#x27;;
            }
            return file;
        });
    }
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
